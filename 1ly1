<!DOCTYPE html>
<html>

<head>
	<title>Mocha</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="node_modules/mocha/mocha.css" />
</head>

<body>
	<main id="main">

	
	
	</main>

	<script src="node_modules/handlebars/dist/handlebars.min.js"></script>
	<script src="index.js"></script>

	<script id="recipe-form-template" type="text/x-handlebars-template">
		<form id="recipe-form" onsubmit="{{ createRecipe }}; return false;">
		  {{> recipeFormPartial }}	
		</form>
		<br>
	</script>
	
	<script id="recipe-form-partial" type="text/x-handlebars-template">
		Name: <input type="text" id="name" value="{{ name  }}"><br> 
		Description: <input type="text" id="description" value="{{ description }}"><br> 
		Ingredients: 
		{{#each ingredients}}
			<input name="ingredients" type="text" value="{{ this.innerHTML }}"><br>
		{{else}}
			<input name="ingredients" type="text"><br>
			<input name="ingredients" type="text"><br>
			<input name="ingredients" type="text"><br>
			<input name="ingredients" type="text"><br>
			<input name="ingredients" type="text"><br>
		{{/each}}
		<input type="submit" value="submit">
	</script>

	<script id="recipe-template" type="text/x-handlebars-template">
		<div id="recipe">
			<h1>RECIPE BELOW</h1>
				    <h3 id="recipe-name">{{ name }}</h3><br>
				    {{> recipeDetailsPartial }}
		    <a href="#" onclick="displayEditForm(this.parentElement)">Edit Recipe</a>
		</div>
	</script>

	<script id="recipe-details-partial" type="text/x-handlebars-template">
		<p id="recipe-description">Description: {{description}}</p>
		<ul id='ingredients'>Ingredients:
		{{#each ingredients}}
			{{displayIngredient this}}
		{{/each}}
		</ul>
	</script>

	<script>
function init() {
  //put any page initialization/handlebars initialization here

  Handlebars.registerPartial('recipeDetailsPartial', document.getElementById('recipe-details-partial').innerHTML);
  Handlebars.registerPartial('recipeFormPartial', document.getElementById('recipe-form-partial').innerHTML);
  Handlebars.registerHelper('displayIngredient', (ingredient) => {
    return new Handlebars.SafeString(
      '<li>'
      + ingredient.value
      + '</li>');
  });
  
  var formInitializer = Handlebars.compile(document.getElementById("recipe-form-template").innerHTML); 
  document.getElementById("main").innerHTML = formInitializer({'createRecipe':'createRecipe()'}); 

}

function createRecipe() {
	
	var context = {
		name: document.getElementById("name").value,
		description: document.getElementById("description").value,
		ingredients: document.getElementsByName('ingredients')
	}
	
	var template = Handlebars.compile(document.getElementById('recipe-template').innerHTML);
	document.getElementById('main').innerHTML = template(context);

}

function displayEditForm() {
	debugger
  var context = {
	  'createRecipe': 'updateRecipe()',
	  name: document.getElementById('recipe-name').innerHTML,
	  description: document.getElementById('recipe-description').innerHTML,
	  ingredients: document.getElementsByTagName('li')
  }

  var editForm = Handlebars.compile(document.getElementById("recipe-form-template").innerHTML);

  document.getElementById('main').innerHTML = editForm(context);
}

function updateRecipe() {
	createRecipe()
}

	document.addEventListener( "DOMContentLoaded", function(event) { 
		init() 
	})

	</script>

	<!-- Open this file and call `mocha.run()` in console to run tests -->
	<div id="mocha"></div>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="node_modules/mocha/mocha.js"></script>
	<script src="node_modules/expect/umd/expect.min.js"></script>
	<script>
		mocha.setup('bdd');
	</script>
	<script src="test/index-test.js"></script>
</body>

</html>
